name: ğŸš€ Deploy Laravel App via FTP (Caartl)

on:
  workflow_dispatch:   # ğŸ‘ˆ Allows manual trigger or custom CLI trigger

jobs:
  build-and-deploy:
    runs-on: ubuntu-latest

    steps:
      # ğŸ›’ Step 1 â€” Checkout code
      - name: Checkout repository
        uses: actions/checkout@v4

      # ğŸ§  Step 2 â€” Set up PHP environment
      - name: Setup PHP
        uses: shivammathur/setup-php@v2
        with:
          php-version: 8.2
          extensions: mbstring, intl, bcmath, mysql, zip
          coverage: none

      # ğŸ“¦ Step 3 â€” Install Composer dependencies (no dev)
      - name: Install Composer dependencies
        run: |
          composer install --no-dev --optimize-autoloader

      # âš™ï¸ Step 4 â€” Build Laravel cache & config
      - name: Optimize Laravel
        run: |
          php artisan config:cache
          php artisan route:cache
          php artisan view:cache
          echo "âœ… Laravel optimized"

      # ğŸš€ Step 5 â€” Deploy via FTP
      - name: Upload to Laravel FTP
        uses: SamKirkland/FTP-Deploy-Action@v4.3.4
        with:
          server: 147.93.107.94
          username: admin_api_gitaction
          password: vdk+@O*2G#L9Bonk
          local-dir: ./
          server-dir: /public_html/
          exclude: |
            **/.git*
            **/.github/**
            **/node_modules/**
            **/vendor/**
            storage/framework/cache/**
            storage/framework/sessions/**
            storage/framework/views/**
            storage/logs/**
            .env
            .htaccess
          dangerous-clean-slate: false
